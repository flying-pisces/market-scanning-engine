{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Market Scanning Engine Signal API Schemas",
  "version": "1.0",
  "definitions": {
    "uuid": {
      "type": "string",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
      "description": "UUID v4 format"
    },
    "score": {
      "type": "integer",
      "minimum": 0,
      "maximum": 100,
      "description": "Score value from 0 to 100"
    },
    "cents": {
      "type": "integer",
      "minimum": 1,
      "description": "Monetary value in cents (to avoid floating point precision issues)"
    },
    "percentage": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "multipleOf": 0.01,
      "description": "Percentage value with 2 decimal places"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp"
    },
    "date": {
      "type": "string",
      "format": "date",
      "description": "ISO 8601 date"
    }
  },
  
  "Signal": {
    "type": "object",
    "title": "Trading Signal",
    "description": "A trading signal with risk scoring and recommendations",
    "required": [
      "asset_id",
      "signal_type_id",
      "signal_name",
      "direction",
      "risk_score",
      "profit_potential_score",
      "confidence_score",
      "signal_source"
    ],
    "properties": {
      "id": {
        "$ref": "#/definitions/uuid",
        "description": "Unique signal identifier"
      },
      "asset_id": {
        "$ref": "#/definitions/uuid",
        "description": "Target asset identifier"
      },
      "signal_type_id": {
        "type": "integer",
        "minimum": 1,
        "description": "Signal type identifier"
      },
      "signal_name": {
        "type": "string",
        "maxLength": 100,
        "description": "Human-readable signal name"
      },
      "direction": {
        "type": "string",
        "enum": ["BUY", "SELL", "HOLD"],
        "description": "Signal direction"
      },
      "generated_at": {
        "$ref": "#/definitions/timestamp",
        "description": "Signal generation time"
      },
      "valid_until": {
        "$ref": "#/definitions/timestamp",
        "description": "Signal expiration time"
      },
      "target_entry_time": {
        "$ref": "#/definitions/timestamp",
        "description": "Recommended entry time"
      },
      "recommended_holding_period_hours": {
        "type": "integer",
        "minimum": 1,
        "description": "Recommended holding period in hours"
      },
      "risk_score": {
        "$ref": "#/definitions/score",
        "description": "Risk assessment score (0=low risk, 100=high risk)"
      },
      "profit_potential_score": {
        "$ref": "#/definitions/score",
        "description": "Profit potential score (0=low potential, 100=high potential)"
      },
      "confidence_score": {
        "$ref": "#/definitions/score",
        "description": "Model confidence score (0=low confidence, 100=high confidence)"
      },
      "sharpe_ratio": {
        "type": "number",
        "minimum": -10,
        "maximum": 10,
        "multipleOf": 0.001,
        "description": "Expected Sharpe ratio"
      },
      "max_drawdown_pct": {
        "$ref": "#/definitions/percentage",
        "description": "Expected maximum drawdown percentage"
      },
      "win_rate_pct": {
        "$ref": "#/definitions/percentage",
        "description": "Historical win rate percentage"
      },
      "entry_price_cents": {
        "$ref": "#/definitions/cents",
        "description": "Recommended entry price in cents"
      },
      "target_price_cents": {
        "$ref": "#/definitions/cents",
        "description": "Target price in cents"
      },
      "stop_loss_price_cents": {
        "$ref": "#/definitions/cents",
        "description": "Stop loss price in cents"
      },
      "recommended_position_size_pct": {
        "$ref": "#/definitions/percentage",
        "description": "Recommended position size as percentage of portfolio"
      },
      "max_position_size_pct": {
        "$ref": "#/definitions/percentage",
        "description": "Maximum recommended position size percentage"
      },
      "signal_source": {
        "type": "string",
        "maxLength": 100,
        "description": "Algorithm or model that generated the signal"
      },
      "methodology_version": {
        "type": "string",
        "maxLength": 20,
        "description": "Version of the methodology used"
      },
      "signal_strength": {
        "type": "string",
        "enum": ["WEAK", "MODERATE", "STRONG", "VERY_STRONG"],
        "description": "Signal strength classification"
      },
      "backtesting": {
        "$ref": "#/SignalBacktest",
        "description": "Backtesting results"
      },
      "asset_specific_data": {
        "type": "object",
        "description": "Asset-class specific signal data",
        "additionalProperties": true
      },
      "tags": {
        "type": "array",
        "items": {
          "type": "string",
          "maxLength": 50
        },
        "description": "Signal tags for categorization"
      },
      "notes": {
        "type": "string",
        "description": "Additional notes about the signal"
      },
      "status": {
        "type": "string",
        "enum": ["ACTIVE", "EXPIRED", "TRIGGERED", "CANCELLED"],
        "description": "Signal status"
      },
      "is_paper_trading": {
        "type": "boolean",
        "description": "Whether this is a paper trading signal"
      },
      "created_at": {
        "$ref": "#/definitions/timestamp"
      },
      "updated_at": {
        "$ref": "#/definitions/timestamp"
      },
      "factors": {
        "type": "array",
        "items": {
          "$ref": "#/SignalFactor"
        },
        "description": "Contributing factors to this signal"
      }
    },
    "additionalProperties": false
  },

  "SignalBacktest": {
    "type": "object",
    "title": "Signal Backtesting Results",
    "description": "Historical performance data for signal validation",
    "properties": {
      "backtest_return_pct": {
        "type": "number",
        "multipleOf": 0.0001,
        "description": "Backtesting return percentage"
      },
      "backtest_volatility_pct": {
        "type": "number",
        "minimum": 0,
        "multipleOf": 0.001,
        "description": "Backtesting volatility percentage"
      },
      "backtest_sample_size": {
        "type": "integer",
        "minimum": 1,
        "description": "Number of backtest samples"
      },
      "backtest_period_start": {
        "$ref": "#/definitions/date",
        "description": "Backtest period start date"
      },
      "backtest_period_end": {
        "$ref": "#/definitions/date",
        "description": "Backtest period end date"
      }
    },
    "additionalProperties": false
  },

  "SignalFactor": {
    "type": "object",
    "title": "Signal Contributing Factor",
    "description": "Individual factor that contributes to signal generation",
    "required": [
      "signal_id",
      "factor_name",
      "contribution_score",
      "weight"
    ],
    "properties": {
      "id": {
        "$ref": "#/definitions/uuid"
      },
      "signal_id": {
        "$ref": "#/definitions/uuid",
        "description": "Parent signal identifier"
      },
      "factor_name": {
        "type": "string",
        "maxLength": 100,
        "description": "Factor name"
      },
      "factor_category": {
        "type": "string",
        "maxLength": 50,
        "enum": ["technical", "fundamental", "sentiment", "momentum", "mean_reversion"],
        "description": "Factor category"
      },
      "contribution_score": {
        "$ref": "#/definitions/score",
        "description": "Factor's contribution to overall signal score"
      },
      "weight": {
        "type": "number",
        "minimum": 0,
        "maximum": 1,
        "multipleOf": 0.0001,
        "description": "Factor weight in signal calculation"
      },
      "factor_value": {
        "type": "number",
        "description": "Raw factor value"
      },
      "factor_percentile": {
        "$ref": "#/definitions/score",
        "description": "Factor value percentile rank"
      },
      "factor_z_score": {
        "type": "number",
        "minimum": -10,
        "maximum": 10,
        "multipleOf": 0.001,
        "description": "Factor z-score"
      },
      "calculation_method": {
        "type": "string",
        "maxLength": 100,
        "description": "Method used to calculate this factor"
      },
      "data_source": {
        "type": "string",
        "maxLength": 50,
        "description": "Data source for this factor"
      },
      "lookback_periods": {
        "type": "integer",
        "minimum": 1,
        "description": "Number of periods used in calculation"
      },
      "created_at": {
        "$ref": "#/definitions/timestamp"
      }
    },
    "additionalProperties": false
  },

  "SignalMatch": {
    "type": "object",
    "title": "Signal User Match",
    "description": "Result of matching a signal to a user's preferences",
    "required": [
      "signal_id",
      "user_id",
      "overall_match_score",
      "risk_tolerance_match",
      "asset_preference_match",
      "time_horizon_match",
      "position_size_match"
    ],
    "properties": {
      "id": {
        "$ref": "#/definitions/uuid"
      },
      "signal_id": {
        "$ref": "#/definitions/uuid",
        "description": "Matched signal identifier"
      },
      "user_id": {
        "$ref": "#/definitions/uuid",
        "description": "Target user identifier"
      },
      "matched_at": {
        "$ref": "#/definitions/timestamp",
        "description": "When the match was computed"
      },
      "overall_match_score": {
        "$ref": "#/definitions/score",
        "description": "Overall match quality score"
      },
      "risk_tolerance_match": {
        "$ref": "#/definitions/score",
        "description": "Risk tolerance alignment score"
      },
      "asset_preference_match": {
        "$ref": "#/definitions/score",
        "description": "Asset preference alignment score"
      },
      "time_horizon_match": {
        "$ref": "#/definitions/score",
        "description": "Time horizon alignment score"
      },
      "position_size_match": {
        "$ref": "#/definitions/score",
        "description": "Position sizing compatibility score"
      },
      "recommended_position_size_pct": {
        "$ref": "#/definitions/percentage",
        "description": "User-specific recommended position size"
      },
      "recommended_position_size_dollars_cents": {
        "$ref": "#/definitions/cents",
        "description": "Recommended position size in cents"
      },
      "adjusted_stop_loss_cents": {
        "$ref": "#/definitions/cents",
        "description": "User-adjusted stop loss price in cents"
      },
      "adjusted_target_price_cents": {
        "$ref": "#/definitions/cents",
        "description": "User-adjusted target price in cents"
      },
      "match_factors": {
        "type": "object",
        "description": "Detailed breakdown of matching factors",
        "additionalProperties": true
      },
      "exclusion_reasons": {
        "type": "array",
        "items": {
          "type": "string",
          "maxLength": 255
        },
        "description": "Reasons why signal was not matched to user"
      },
      "notification_status": {
        "type": "string",
        "enum": ["PENDING", "SENT", "READ", "DISMISSED", "ACTED_ON"],
        "description": "Status of user notification"
      },
      "notification_sent_at": {
        "$ref": "#/definitions/timestamp",
        "description": "When notification was sent to user"
      },
      "user_response": {
        "type": "string",
        "enum": ["INTERESTED", "NOT_INTERESTED", "MAYBE", "ALREADY_HAVE"],
        "description": "User's response to the signal"
      },
      "user_response_at": {
        "$ref": "#/definitions/timestamp",
        "description": "When user responded"
      },
      "expires_at": {
        "$ref": "#/definitions/timestamp",
        "description": "When this match expires"
      },
      "matching_algorithm_version": {
        "type": "string",
        "maxLength": 20,
        "description": "Version of matching algorithm used"
      },
      "created_at": {
        "$ref": "#/definitions/timestamp"
      },
      "updated_at": {
        "$ref": "#/definitions/timestamp"
      }
    },
    "additionalProperties": false
  },

  "RiskAssessment": {
    "type": "object",
    "title": "Asset Risk Assessment",
    "description": "Comprehensive multi-factor risk analysis for an asset",
    "required": [
      "asset_id",
      "overall_risk_score"
    ],
    "properties": {
      "id": {
        "$ref": "#/definitions/uuid"
      },
      "asset_id": {
        "$ref": "#/definitions/uuid",
        "description": "Asset being assessed"
      },
      "assessment_timestamp": {
        "$ref": "#/definitions/timestamp",
        "description": "When assessment was performed"
      },
      "overall_risk_score": {
        "$ref": "#/definitions/score",
        "description": "Overall risk score (0=low risk, 100=high risk)"
      },
      "market_risk_score": {
        "$ref": "#/definitions/score",
        "description": "Market risk component score"
      },
      "liquidity_risk_score": {
        "$ref": "#/definitions/score",
        "description": "Liquidity risk component score"
      },
      "credit_risk_score": {
        "$ref": "#/definitions/score",
        "description": "Credit risk component score"
      },
      "volatility_risk_score": {
        "$ref": "#/definitions/score",
        "description": "Volatility risk component score"
      },
      "concentration_risk_score": {
        "$ref": "#/definitions/score",
        "description": "Concentration risk component score"
      },
      "beta": {
        "type": "number",
        "minimum": -5,
        "maximum": 5,
        "multipleOf": 0.0001,
        "description": "Beta coefficient relative to market"
      },
      "var_1d_pct": {
        "type": "number",
        "minimum": 0,
        "maximum": 100,
        "multipleOf": 0.001,
        "description": "1-day Value at Risk (95% confidence)"
      },
      "var_5d_pct": {
        "type": "number",
        "minimum": 0,
        "maximum": 100,
        "multipleOf": 0.001,
        "description": "5-day Value at Risk (95% confidence)"
      },
      "expected_shortfall_pct": {
        "type": "number",
        "minimum": 0,
        "maximum": 100,
        "multipleOf": 0.001,
        "description": "Expected Shortfall (Conditional VaR)"
      },
      "realized_volatility_30d_pct": {
        "type": "number",
        "minimum": 0,
        "maximum": 1000,
        "multipleOf": 0.001,
        "description": "30-day realized volatility percentage"
      },
      "implied_volatility_pct": {
        "type": "number",
        "minimum": 0,
        "maximum": 1000,
        "multipleOf": 0.001,
        "description": "Implied volatility percentage"
      },
      "volatility_skew": {
        "type": "number",
        "minimum": -10,
        "maximum": 10,
        "multipleOf": 0.001,
        "description": "Volatility skew measure"
      },
      "bid_ask_spread_bps": {
        "type": "integer",
        "minimum": 0,
        "maximum": 10000,
        "description": "Bid-ask spread in basis points"
      },
      "average_daily_volume_20d": {
        "type": "integer",
        "minimum": 0,
        "description": "20-day average daily volume"
      },
      "turnover_ratio": {
        "type": "number",
        "minimum": 0,
        "maximum": 100,
        "multipleOf": 0.0001,
        "description": "Daily turnover ratio"
      },
      "market_impact_score": {
        "$ref": "#/definitions/score",
        "description": "Expected market impact score for typical trade sizes"
      },
      "market_regime": {
        "type": "string",
        "enum": ["bull_market", "bear_market", "sideways", "high_vol", "low_vol"],
        "description": "Current market regime classification"
      },
      "regime_confidence_pct": {
        "$ref": "#/definitions/score",
        "description": "Confidence in market regime classification"
      },
      "model_version": {
        "type": "string",
        "maxLength": 20,
        "description": "Risk model version"
      },
      "calculation_method": {
        "type": "string",
        "maxLength": 100,
        "description": "Method used for risk calculation"
      },
      "data_quality_score": {
        "$ref": "#/definitions/score",
        "description": "Quality of underlying data used"
      },
      "created_at": {
        "$ref": "#/definitions/timestamp"
      }
    },
    "additionalProperties": false
  },

  "SignalPerformance": {
    "type": "object",
    "title": "Signal Performance Tracking",
    "description": "Track how well a signal performed over time",
    "required": [
      "signal_id",
      "evaluation_date",
      "days_since_signal"
    ],
    "properties": {
      "id": {
        "$ref": "#/definitions/uuid"
      },
      "signal_id": {
        "$ref": "#/definitions/uuid",
        "description": "Signal being tracked"
      },
      "evaluation_date": {
        "$ref": "#/definitions/date",
        "description": "Date of performance evaluation"
      },
      "days_since_signal": {
        "type": "integer",
        "minimum": 0,
        "description": "Days elapsed since signal generation"
      },
      "entry_price_cents": {
        "$ref": "#/definitions/cents",
        "description": "Actual entry price in cents"
      },
      "current_price_cents": {
        "$ref": "#/definitions/cents",
        "description": "Current asset price in cents"
      },
      "high_since_signal_cents": {
        "$ref": "#/definitions/cents",
        "description": "Highest price since signal in cents"
      },
      "low_since_signal_cents": {
        "$ref": "#/definitions/cents",
        "description": "Lowest price since signal in cents"
      },
      "unrealized_pnl_pct": {
        "type": "number",
        "minimum": -100,
        "maximum": 10000,
        "multipleOf": 0.0001,
        "description": "Unrealized profit/loss percentage"
      },
      "realized_pnl_pct": {
        "type": "number",
        "minimum": -100,
        "maximum": 10000,
        "multipleOf": 0.0001,
        "description": "Realized profit/loss percentage"
      },
      "max_favorable_excursion_pct": {
        "type": "number",
        "minimum": 0,
        "maximum": 10000,
        "multipleOf": 0.0001,
        "description": "Maximum favorable price movement percentage"
      },
      "max_adverse_excursion_pct": {
        "type": "number",
        "minimum": -100,
        "maximum": 0,
        "multipleOf": 0.0001,
        "description": "Maximum adverse price movement percentage"
      },
      "current_risk_score": {
        "$ref": "#/definitions/score",
        "description": "Current risk assessment for this position"
      },
      "volatility_realized_pct": {
        "type": "number",
        "minimum": 0,
        "maximum": 1000,
        "multipleOf": 0.001,
        "description": "Realized volatility since signal"
      },
      "position_status": {
        "type": "string",
        "enum": ["OPEN", "CLOSED", "STOPPED_OUT", "TARGET_HIT"],
        "description": "Current position status"
      },
      "created_at": {
        "$ref": "#/definitions/timestamp"
      }
    },
    "additionalProperties": false
  }
}